{% extends "layout.html" %}

{% block extra_css %}
<style>
  .casino-container {
    max-width: 900px;
    margin: 0 auto;
  }
  
  .games-tab {
    margin-bottom: 20px;
  }
  
  /* ë£°ë › ìŠ¤íƒ€ì¼ */
  .roulette-container {
    display: flex;
    flex-direction: column;
    align-items: center;
    margin-bottom: 30px;
  }
  
  .roulette-wheel {
    width: 300px;
    height: 300px;
    position: relative;
    border-radius: 50%;
    background: #E0E0E0;
    overflow: hidden;
    box-shadow: 0 0 10px rgba(0,0,0,0.3);
    margin-bottom: 20px;
  }
  
  .wheel-center {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 50px;
    height: 50px;
    background: #333;
    border-radius: 50%;
    z-index: 10;
  }
  
  .wheel-segment {
    position: absolute;
    width: 0;
    height: 0;
    border-style: solid;
    transform-origin: 100% 100%;
  }
  
  .wheel-number {
    position: absolute;
    transform-origin: center;
    text-align: center;
    font-weight: bold;
    color: white;
    font-size: 14px;
  }
  
  .wheel-marker {
    position: absolute;
    top: 0;
    left: 50%;
    transform: translateX(-50%);
    width: 20px;
    height: 30px;
    background: #D50000;
    clip-path: polygon(50% 0%, 0% 100%, 100% 100%);
    z-index: 20;
  }
  
  .betting-board {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    grid-gap: 10px;
    margin-top: 20px;
  }
  
  .bet-option {
    padding: 10px;
    text-align: center;
    background: #4CAF50;
    color: white;
    border-radius: 5px;
    cursor: pointer;
    transition: background-color 0.2s;
  }
  
  .bet-option:hover {
    background: #388E3C;
  }
  
  .bet-option.selected {
    background: #1B5E20;
    font-weight: bold;
    transform: scale(1.05);
  }
  
  .number-board {
    display: grid;
    grid-template-columns: repeat(6, 1fr);
    grid-gap: 5px;
    margin-top: 20px;
  }
  
  .number-bet {
    padding: 10px;
    text-align: center;
    background: #1976D2;
    color: white;
    border-radius: 5px;
    cursor: pointer;
    transition: background-color 0.2s;
  }
  
  .number-bet:hover {
    background: #1565C0;
  }
  
  .number-bet.selected {
    background: #0D47A1;
    font-weight: bold;
    transform: scale(1.05);
  }
  
  /* ìŠ¬ë¡¯ë¨¸ì‹  ìŠ¤íƒ€ì¼ */
  .slot-machine {
    background: linear-gradient(to bottom, #4A148C, #7B1FA2);
    border-radius: 10px;
    padding: 20px;
    box-shadow: 0 5px 15px rgba(0,0,0,0.3);
    display: flex;
    flex-direction: column;
    align-items: center;
  }
  
  .slot-display {
    background: #E0E0E0;
    border-radius: 10px;
    padding: 20px;
    margin-bottom: 20px;
    display: flex;
    justify-content: center;
    width: 300px;
  }
  
  .slot-reel {
    width: 80px;
    height: 120px;
    background: white;
    margin: 0 5px;
    border-radius: 5px;
    display: flex;
    justify-content: center;
    align-items: center;
    font-size: 50px;
    overflow: hidden;
    position: relative;
  }
  
  .slot-symbol {
    position: absolute;
    width: 100%;
    height: 100%;
    display: flex;
    justify-content: center;
    align-items: center;
    transition: top 1s cubic-bezier(0.25, 0.1, 0.25, 1);
  }
  
  .slot-controls {
    display: flex;
    flex-direction: column;
    align-items: center;
    width: 100%;
  }
  
  .spin-button {
    background: #FFC107;
    color: #333;
    font-size: 20px;
    padding: 10px 20px;
    border: none;
    border-radius: 50px;
    margin-top: 20px;
    cursor: pointer;
    width: 200px;
    transition: all 0.2s;
  }
  
  .spin-button:hover {
    background: #FFA000;
    transform: scale(1.05);
  }
  
  .spin-button:disabled {
    background: #9E9E9E;
    cursor: not-allowed;
    transform: none;
  }
  
  .bet-controls {
    display: flex;
    justify-content: center;
    margin-top: 20px;
    width: 100%;
  }
  
  .bet-input {
    flex-grow: 1;
    max-width: 200px;
    text-align: center;
    font-size: 24px;
    font-weight: bold;
    margin: 0 10px;
  }
  
  .bet-button {
    background: #2196F3;
    color: white;
    border: none;
    border-radius: 50%;
    width: 40px;
    height: 40px;
    font-size: 20px;
    cursor: pointer;
  }
  
  .result-message {
    margin-top: 20px;
    font-size: 24px;
    font-weight: bold;
    text-align: center;
  }
  
  .win {
    color: #4CAF50;
  }
  
  .lose {
    color: #F44336;
  }
</style>
{% endblock %}

{% block content %}
<div class="container">
  <div class="card shadow-sm mb-4">
    <div class="card-header bg-danger text-white">
      <h2 class="mb-0"><i class="fas fa-dice me-2"></i>ì¹´ì§€ë…¸ ê²Œì„</h2>
    </div>
    <div class="card-body">
      <div class="balance-display mb-3 p-3 bg-light rounded">
        <h5 class="mb-0"><i class="fas fa-wallet me-2"></i>í˜„ì¬ ì”ì•¡: <span class="text-primary fw-bold" id="user-balance">{{ g.user.balance }}{{ system_config.get('currency_symbol', 'CM') }}</span></h5>
      </div>
      
      <div class="casino-container">
        <!-- ê²Œì„ ì„ íƒ íƒ­ -->
        <ul class="nav nav-tabs games-tab" id="casinoTabs" role="tablist">
          <li class="nav-item" role="presentation">
            <button class="nav-link active" id="roulette-tab" data-bs-toggle="tab" data-bs-target="#roulette" type="button" role="tab" aria-controls="roulette" aria-selected="true">
              <i class="fas fa-circle-notch me-2"></i>ë£°ë ›
            </button>
          </li>
          <li class="nav-item" role="presentation">
            <button class="nav-link" id="slot-tab" data-bs-toggle="tab" data-bs-target="#slot" type="button" role="tab" aria-controls="slot" aria-selected="false">
              <i class="fas fa-slot-machine me-2"></i>ìŠ¬ë¡¯ë¨¸ì‹ 
            </button>
          </li>
        </ul>
        
        <div class="tab-content" id="casinoTabContent">
          <!-- ë£°ë › ê²Œì„ -->
          <div class="tab-pane fade show active" id="roulette" role="tabpanel" aria-labelledby="roulette-tab">
            <div class="row">
              <div class="col-md-6">
                <div class="roulette-container">
                  <h4 class="mb-3">ë£°ë › íœ </h4>
                  <div class="roulette-wheel">
                    <div class="wheel-marker"></div>
                    <div class="wheel-center"></div>
                    <!-- ë£°ë › ì„¸ê·¸ë¨¼íŠ¸ëŠ” ìë°”ìŠ¤í¬ë¦½íŠ¸ë¡œ ìƒì„±ë©ë‹ˆë‹¤ -->
                  </div>
                  <div class="mt-3" id="roulette-result"></div>
                </div>
              </div>
              
              <div class="col-md-6">
                <div class="card mb-3">
                  <div class="card-header bg-primary text-white">
                    <h4 class="mb-0"><i class="fas fa-coins me-2"></i>ë² íŒ…</h4>
                  </div>
                  <div class="card-body">
                    <form id="roulette-bet-form">
                      <div class="mb-3">
                        <label for="roulette-bet-amount" class="form-label">ë°°íŒ… ê¸ˆì•¡</label>
                        <div class="input-group">
                          <input type="number" class="form-control" id="roulette-bet-amount" min="500" max="{{ g.user.balance }}" value="500" required>
                          <span class="input-group-text">{{ system_config.get('currency_symbol', 'CM') }}</span>
                        </div>
                        <div class="form-text">ìµœì†Œ 500{{ system_config.get('currency_symbol', 'CM') }}ë¶€í„° ë°°íŒ… ê°€ëŠ¥í•©ë‹ˆë‹¤.</div>
                      </div>
                      
                      <div class="mb-3">
                        <label class="form-label">ë² íŒ… ì˜µì…˜</label>
                        <div class="betting-board">
                          <div class="bet-option" data-type="odd">í™€ìˆ˜</div>
                          <div class="bet-option" data-type="even">ì§ìˆ˜</div>
                          <div class="bet-option" data-type="red">ë¹¨ê°•</div>
                          <div class="bet-option" data-type="black">ê²€ì •</div>
                          <div class="bet-option" data-type="1-18">1-18</div>
                          <div class="bet-option" data-type="19-36">19-36</div>
                        </div>
                      </div>
                      
                      <div class="mb-3">
                        <label class="form-label">ë²ˆí˜¸ ë² íŒ… (35ë°°)</label>
                        <div class="number-board" id="number-board">
                          <!-- ë²ˆí˜¸ëŠ” ìë°”ìŠ¤í¬ë¦½íŠ¸ë¡œ ìƒì„±ë©ë‹ˆë‹¤ -->
                        </div>
                      </div>
                      
                      <div class="mb-3">
                        <div id="bet-summary">ì„ íƒí•œ ë² íŒ…: <span id="selected-bet">ì—†ìŒ</span></div>
                      </div>
                      
                      <div class="d-grid">
                        <button type="submit" class="btn btn-danger btn-lg" id="spin-button" disabled>
                          <i class="fas fa-play me-2"></i>ë£°ë › ëŒë¦¬ê¸°
                        </button>
                      </div>
                    </form>
                  </div>
                </div>
              </div>
            </div>
          </div>
          
          <!-- ìŠ¬ë¡¯ë¨¸ì‹  ê²Œì„ -->
          <div class="tab-pane fade" id="slot" role="tabpanel" aria-labelledby="slot-tab">
            <div class="slot-machine">
              <h4 class="text-white mb-3">ìŠ¬ë¡¯ë¨¸ì‹ </h4>
              
              <div class="slot-display">
                <div class="slot-reel" id="reel1">
                  <div class="slot-symbol">ğŸ’</div>
                </div>
                <div class="slot-reel" id="reel2">
                  <div class="slot-symbol">ğŸ‹</div>
                </div>
                <div class="slot-reel" id="reel3">
                  <div class="slot-symbol">ğŸ‡</div>
                </div>
              </div>
              
              <div class="slot-controls">
                <div class="bet-controls">
                  <button class="bet-button" id="decrease-bet">-</button>
                  <div class="bet-input">
                    <label for="slot-bet-amount">ë°°íŒ…:</label>
                    <input type="number" id="slot-bet-amount" min="500" max="{{ g.user.balance }}" value="500" readonly>
                  </div>
                  <button class="bet-button" id="increase-bet">+</button>
                </div>
                
                <button class="spin-button" id="slot-spin-button">
                  <i class="fas fa-sync-alt me-2"></i>ìŠ¤í•€!
                </button>
                
                <div class="result-message" id="slot-result"></div>
              </div>
            </div>
            
            <div class="card mt-4">
              <div class="card-header bg-info text-white">
                <h4 class="mb-0"><i class="fas fa-info-circle me-2"></i>ìŠ¬ë¡¯ë¨¸ì‹  ë°°ë‹¹</h4>
              </div>
              <div class="card-body">
                <table class="table table-striped">
                  <thead>
                    <tr>
                      <th>ì¡°í•©</th>
                      <th>ë°°ë‹¹</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr>
                      <td>ğŸ’ ğŸ’ ğŸ’</td>
                      <td>ë°°íŒ…ê¸ˆì•¡ì˜ 7ë°°</td>
                    </tr>
                    <tr>
                      <td>ğŸ‹ ğŸ‹ ğŸ‹</td>
                      <td>ë°°íŒ…ê¸ˆì•¡ì˜ 5ë°°</td>
                    </tr>
                    <tr>
                      <td>ğŸ‡ ğŸ‡ ğŸ‡</td>
                      <td>ë°°íŒ…ê¸ˆì•¡ì˜ 3ë°°</td>
                    </tr>
                    <tr>
                      <td>ğŸ’° ğŸ’° ğŸ’°</td>
                      <td>ë°°íŒ…ê¸ˆì•¡ì˜ 10ë°°</td>
                    </tr>
                    <tr>
                      <td>ë™ì¼í•œ ë‘ ê°œì˜ ì‹¬ë³¼</td>
                      <td>ë°°íŒ…ê¸ˆì•¡ì˜ 2ë°°</td>
                    </tr>
                    <tr>
                      <td>ê·¸ ì™¸</td>
                      <td>íŒ¨ë°°</td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
  document.addEventListener('DOMContentLoaded', function() {
    const userBalance = document.getElementById('user-balance');
    
    // ë£°ë › ê²Œì„
    const rouletteWheel = document.querySelector('.roulette-wheel');
    const spinButton = document.getElementById('spin-button');
    const rouletteBetForm = document.getElementById('roulette-bet-form');
    const rouletteBetAmount = document.getElementById('roulette-bet-amount');
    const betOptions = document.querySelectorAll('.bet-option');
    const numberBoard = document.getElementById('number-board');
    const selectedBet = document.getElementById('selected-bet');
    const rouletteResult = document.getElementById('roulette-result');
    
    let isSpinning = false;
    let selectedBetType = null;
    let selectedNumber = null;
    
    // ë£°ë › ë²ˆí˜¸ì™€ ìƒ‰ìƒ
    const rouletteNumbers = [
      { number: 0, color: 'green' },
      { number: 32, color: 'red' }, { number: 15, color: 'black' }, { number: 19, color: 'red' },
      { number: 4, color: 'black' }, { number: 21, color: 'red' }, { number: 2, color: 'black' },
      { number: 25, color: 'red' }, { number: 17, color: 'black' }, { number: 34, color: 'red' },
      { number: 6, color: 'black' }, { number: 27, color: 'red' }, { number: 13, color: 'black' },
      { number: 36, color: 'red' }, { number: 11, color: 'black' }, { number: 30, color: 'red' },
      { number: 8, color: 'black' }, { number: 23, color: 'red' }, { number: 10, color: 'black' },
      { number: 5, color: 'red' }, { number: 24, color: 'black' }, { number: 16, color: 'red' },
      { number: 33, color: 'black' }, { number: 1, color: 'red' }, { number: 20, color: 'black' },
      { number: 14, color: 'red' }, { number: 31, color: 'black' }, { number: 9, color: 'red' },
      { number: 22, color: 'black' }, { number: 18, color: 'red' }, { number: 29, color: 'black' },
      { number: 7, color: 'red' }, { number: 28, color: 'black' }, { number: 12, color: 'red' },
      { number: 35, color: 'black' }, { number: 3, color: 'red' }, { number: 26, color: 'black' }
    ];
    
    // ë£°ë › íœ  ìƒì„±
    function createRouletteWheel() {
      // ì„¸ê·¸ë¨¼íŠ¸ ê°ë„
      const segmentAngle = 360 / rouletteNumbers.length;
      
      rouletteNumbers.forEach((item, index) => {
        const segment = document.createElement('div');
        segment.className = 'wheel-segment';
        
        // ì„¸ê·¸ë¨¼íŠ¸ ìŠ¤íƒ€ì¼ ì„¤ì •
        segment.style.borderWidth = '150px 25px 0';
        segment.style.borderColor = `${item.color} transparent transparent`;
        segment.style.transform = `rotate(${index * segmentAngle}deg)`;
        segment.style.left = '125px';
        segment.style.top = '0';
        
        // ë²ˆí˜¸ í…ìŠ¤íŠ¸ ì¶”ê°€
        const numberText = document.createElement('div');
        numberText.className = 'wheel-number';
        numberText.textContent = item.number;
        
        // ë²ˆí˜¸ ìœ„ì¹˜ ê³„ì‚°
        const angle = (index * segmentAngle + segmentAngle / 2) * Math.PI / 180;
        const distance = 100;
        const x = Math.sin(angle) * distance + 150;
        const y = -Math.cos(angle) * distance + 150;
        
        numberText.style.left = `${x}px`;
        numberText.style.top = `${y}px`;
        numberText.style.transform = `translate(-50%, -50%) rotate(${90 + index * segmentAngle}deg)`;
        
        rouletteWheel.appendChild(segment);
        rouletteWheel.appendChild(numberText);
      });
    }
    
    // ë²ˆí˜¸íŒ ìƒì„±
    function createNumberBoard() {
      for (let i = 1; i <= 36; i++) {
        const numberBet = document.createElement('div');
        numberBet.className = 'number-bet';
        numberBet.textContent = i;
        
        // í™€ìˆ˜/ì§ìˆ˜ì— ë”°ë¼ ë°°ê²½ìƒ‰ ì„¤ì •
        const color = rouletteNumbers.find(item => item.number === i).color;
        numberBet.style.backgroundColor = color === 'red' ? '#D32F2F' : '#212121';
        
        numberBet.addEventListener('click', function() {
          // ë‹¤ë¥¸ ë²ˆí˜¸ ì„ íƒ ì´ˆê¸°í™”
          document.querySelectorAll('.number-bet').forEach(btn => btn.classList.remove('selected'));
          betOptions.forEach(option => option.classList.remove('selected'));
          
          numberBet.classList.add('selected');
          selectedBetType = 'number';
          selectedNumber = i;
          selectedBet.textContent = `ë²ˆí˜¸ ${i} (35ë°°)`;
          spinButton.disabled = false;
        });
        
        numberBoard.appendChild(numberBet);
      }
    }
    
    // ë² íŒ… ì˜µì…˜ í´ë¦­ ì´ë²¤íŠ¸
    betOptions.forEach(option => {
      option.addEventListener('click', function() {
        // ë‹¤ë¥¸ ì˜µì…˜ ì„ íƒ ì´ˆê¸°í™”
        betOptions.forEach(opt => opt.classList.remove('selected'));
        document.querySelectorAll('.number-bet').forEach(btn => btn.classList.remove('selected'));
        
        option.classList.add('selected');
        selectedBetType = option.dataset.type;
        selectedNumber = null;
        
        // ë² íŒ… ì„¤ëª… ì—…ë°ì´íŠ¸
        let betDescription = '';
        switch (selectedBetType) {
          case 'odd':
            betDescription = 'í™€ìˆ˜ (1ë°°)';
            break;
          case 'even':
            betDescription = 'ì§ìˆ˜ (1ë°°)';
            break;
          case 'red':
            betDescription = 'ë¹¨ê°• (1ë°°)';
            break;
          case 'black':
            betDescription = 'ê²€ì • (1ë°°)';
            break;
          case '1-18':
            betDescription = '1-18 (1ë°°)';
            break;
          case '19-36':
            betDescription = '19-36 (1ë°°)';
            break;
        }
        
        selectedBet.textContent = betDescription;
        spinButton.disabled = false;
      });
    });
    
    // ë£°ë › í¼ ì œì¶œ
    rouletteBetForm.addEventListener('submit', function(e) {
      e.preventDefault();
      
      if (isSpinning) return;
      
      const betAmount = parseInt(rouletteBetAmount.value);
      
      if (isNaN(betAmount) || betAmount < 500) {
        alert('ìµœì†Œ 500{{ system_config.get('currency_symbol', 'CM') }} ì´ìƒ ë°°íŒ…í•´ì•¼ í•©ë‹ˆë‹¤.');
        return;
      }
      
      if (betAmount > parseInt(userBalance.textContent.replace(/[^0-9]/g, ''))) {
        alert('ì”ì•¡ì´ ë¶€ì¡±í•©ë‹ˆë‹¤.');
        return;
      }
      
      if (!selectedBetType) {
        alert('ë² íŒ… ì˜µì…˜ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
        return;
      }
      
      // ë£°ë › ìŠ¤í•€ ì‹œì‘
      spinRouletteWheel(betAmount);
    });
    
    // ë£°ë › ìŠ¤í•€
    function spinRouletteWheel(betAmount) {
      isSpinning = true;
      spinButton.disabled = true;
      rouletteResult.textContent = '';
      
      // ëœë¤ íšŒì „ ê°ë„ (10-20 íšŒì „ + ë‹¹ì²¨ ìœ„ì¹˜)
      const randomIndex = Math.floor(Math.random() * rouletteNumbers.length);
      const winningNumber = rouletteNumbers[randomIndex].number;
      const spinDegrees = 3600 + (randomIndex * (360 / rouletteNumbers.length));
      
      // ë£°ë › ì• ë‹ˆë©”ì´ì…˜
      rouletteWheel.style.transition = 'transform 5s cubic-bezier(0.25, 0.1, 0.25, 1)';
      rouletteWheel.style.transform = `rotate(${spinDegrees}deg)`;
      
      // ìŠ¤í•€ ì™„ë£Œ í›„ ê²°ê³¼ ì²˜ë¦¬
      setTimeout(() => {
        isSpinning = false;
        spinButton.disabled = false;
        
        let result = '';
        let winAmount = 0;
        
        // ë² íŒ… ê²°ê³¼ ê³„ì‚°
        if (selectedBetType === 'number' && selectedNumber === winningNumber) {
          // ë²ˆí˜¸ ì •í™•íˆ ë§ì·„ì„ ë•Œ (35ë°°)
          winAmount = betAmount * 35;
          result = 'big_win';
          rouletteResult.innerHTML = `<div class="alert alert-success">
            <h4>ë‹¹ì²¨! ë²ˆí˜¸ ${winningNumber}</h4>
            <p>ë² íŒ…: ${betAmount}{{ system_config.get('currency_symbol', 'CM') }}, ë‹¹ì²¨ê¸ˆ: ${winAmount}{{ system_config.get('currency_symbol', 'CM') }} (35ë°°)</p>
          </div>`;
        } else if (selectedBetType === 'odd' && winningNumber !== 0 && winningNumber % 2 === 1) {
          // í™€ìˆ˜ ë² íŒ… ì„±ê³µ (1ë°°)
          winAmount = betAmount * 2;
          result = 'small_win';
          rouletteResult.innerHTML = `<div class="alert alert-success">
            <h4>ë‹¹ì²¨! ë²ˆí˜¸ ${winningNumber} (í™€ìˆ˜)</h4>
            <p>ë² íŒ…: ${betAmount}{{ system_config.get('currency_symbol', 'CM') }}, ë‹¹ì²¨ê¸ˆ: ${winAmount}{{ system_config.get('currency_symbol', 'CM') }} (2ë°°)</p>
          </div>`;
        } else if (selectedBetType === 'even' && winningNumber !== 0 && winningNumber % 2 === 0) {
          // ì§ìˆ˜ ë² íŒ… ì„±ê³µ (1ë°°)
          winAmount = betAmount * 2;
          result = 'small_win';
          rouletteResult.innerHTML = `<div class="alert alert-success">
            <h4>ë‹¹ì²¨! ë²ˆí˜¸ ${winningNumber} (ì§ìˆ˜)</h4>
            <p>ë² íŒ…: ${betAmount}{{ system_config.get('currency_symbol', 'CM') }}, ë‹¹ì²¨ê¸ˆ: ${winAmount}{{ system_config.get('currency_symbol', 'CM') }} (2ë°°)</p>
          </div>`;
        } else if (selectedBetType === 'red' && rouletteNumbers.find(item => item.number === winningNumber).color === 'red') {
          // ë¹¨ê°„ìƒ‰ ë² íŒ… ì„±ê³µ (1ë°°)
          winAmount = betAmount * 2;
          result = 'small_win';
          rouletteResult.innerHTML = `<div class="alert alert-success">
            <h4>ë‹¹ì²¨! ë²ˆí˜¸ ${winningNumber} (ë¹¨ê°•)</h4>
            <p>ë² íŒ…: ${betAmount}{{ system_config.get('currency_symbol', 'CM') }}, ë‹¹ì²¨ê¸ˆ: ${winAmount}{{ system_config.get('currency_symbol', 'CM') }} (2ë°°)</p>
          </div>`;
        } else if (selectedBetType === 'black' && rouletteNumbers.find(item => item.number === winningNumber).color === 'black') {
          // ê²€ì€ìƒ‰ ë² íŒ… ì„±ê³µ (1ë°°)
          winAmount = betAmount * 2;
          result = 'small_win';
          rouletteResult.innerHTML = `<div class="alert alert-success">
            <h4>ë‹¹ì²¨! ë²ˆí˜¸ ${winningNumber} (ê²€ì •)</h4>
            <p>ë² íŒ…: ${betAmount}{{ system_config.get('currency_symbol', 'CM') }}, ë‹¹ì²¨ê¸ˆ: ${winAmount}{{ system_config.get('currency_symbol', 'CM') }} (2ë°°)</p>
          </div>`;
        } else if (selectedBetType === '1-18' && winningNumber >= 1 && winningNumber <= 18) {
          // 1-18 ë² íŒ… ì„±ê³µ (1ë°°)
          winAmount = betAmount * 2;
          result = 'small_win';
          rouletteResult.innerHTML = `<div class="alert alert-success">
            <h4>ë‹¹ì²¨! ë²ˆí˜¸ ${winningNumber} (1-18)</h4>
            <p>ë² íŒ…: ${betAmount}{{ system_config.get('currency_symbol', 'CM') }}, ë‹¹ì²¨ê¸ˆ: ${winAmount}{{ system_config.get('currency_symbol', 'CM') }} (2ë°°)</p>
          </div>`;
        } else if (selectedBetType === '19-36' && winningNumber >= 19 && winningNumber <= 36) {
          // 19-36 ë² íŒ… ì„±ê³µ (1ë°°)
          winAmount = betAmount * 2;
          result = 'small_win';
          rouletteResult.innerHTML = `<div class="alert alert-success">
            <h4>ë‹¹ì²¨! ë²ˆí˜¸ ${winningNumber} (19-36)</h4>
            <p>ë² íŒ…: ${betAmount}{{ system_config.get('currency_symbol', 'CM') }}, ë‹¹ì²¨ê¸ˆ: ${winAmount}{{ system_config.get('currency_symbol', 'CM') }} (2ë°°)</p>
          </div>`;
        } else {
          // íŒ¨ë°°
          winAmount = 0;
          result = 'lose';
          rouletteResult.innerHTML = `<div class="alert alert-danger">
            <h4>ì‹¤íŒ¨! ë²ˆí˜¸ ${winningNumber}</h4>
            <p>ë² íŒ…: ${betAmount}{{ system_config.get('currency_symbol', 'CM') }}, ë‹¹ì²¨ê¸ˆ: 0{{ system_config.get('currency_symbol', 'CM') }}</p>
          </div>`;
        }
        
        // ì„œë²„ì— ê²Œì„ ê²°ê³¼ ì „ì†¡
        fetch('{{ url_for("games.place_bet") }}', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/x-www-form-urlencoded',
          },
          body: `game_id=casino&bet_amount=${betAmount}&game_data=roulette_${winningNumber}`
        })
        .then(response => response.json())
        .then(data => {
          if (data.success) {
            // ì”ì•¡ ì—…ë°ì´íŠ¸
            userBalance.textContent = `${data.new_balance}{{ system_config.get('currency_symbol', 'CM') }}`;
          } else {
            alert(data.message);
          }
        })
        .catch(error => {
          console.error('Error:', error);
          alert('ê²Œì„ ê²°ê³¼ë¥¼ ì²˜ë¦¬í•˜ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
        });
      }, 5000);
    }
    
    // ë£°ë › íœ  ë° ë²ˆí˜¸íŒ ìƒì„±
    createRouletteWheel();
    createNumberBoard();
    
    // ìŠ¬ë¡¯ë¨¸ì‹  ê²Œì„
    const slotReels = [
      document.getElementById('reel1').querySelector('.slot-symbol'),
      document.getElementById('reel2').querySelector('.slot-symbol'),
      document.getElementById('reel3').querySelector('.slot-symbol')
    ];
    const decreaseBetBtn = document.getElementById('decrease-bet');
    const increaseBetBtn = document.getElementById('increase-bet');
    const slotBetAmount = document.getElementById('slot-bet-amount');
    const slotSpinButton = document.getElementById('slot-spin-button');
    const slotResult = document.getElementById('slot-result');
    
    let isSlotSpinning = false;
    const symbols = ['ğŸ’', 'ğŸ‹', 'ğŸ‡', 'ğŸ’°', 'ğŸ', 'â­'];
    
    // ë² íŒ… ê¸ˆì•¡ ì¡°ì ˆ
    decreaseBetBtn.addEventListener('click', function() {
      let bet = parseInt(slotBetAmount.value);
      if (bet > 500) {
        bet -= 500;
        slotBetAmount.value = bet;
      }
    });
    
    increaseBetBtn.addEventListener('click', function() {
      let bet = parseInt(slotBetAmount.value);
      const max = parseInt(userBalance.textContent.replace(/[^0-9]/g, ''));
      
      if (bet + 500 <= max) {
        bet += 500;
        slotBetAmount.value = bet;
      }
    });
    
    // ìŠ¬ë¡¯ë¨¸ì‹  ìŠ¤í•€
    slotSpinButton.addEventListener('click', function() {
      if (isSlotSpinning) return;
      
      const betAmount = parseInt(slotBetAmount.value);
      
      if (isNaN(betAmount) || betAmount < 500) {
        alert('ìµœì†Œ 500{{ system_config.get('currency_symbol', 'CM') }} ì´ìƒ ë°°íŒ…í•´ì•¼ í•©ë‹ˆë‹¤.');
        return;
      }
      
      if (betAmount > parseInt(userBalance.textContent.replace(/[^0-9]/g, ''))) {
        alert('ì”ì•¡ì´ ë¶€ì¡±í•©ë‹ˆë‹¤.');
        return;
      }
      
      spinSlotMachine(betAmount);
    });
    
    // ìŠ¬ë¡¯ë¨¸ì‹  ìŠ¤í•€ í•¨ìˆ˜
    function spinSlotMachine(betAmount) {
      isSlotSpinning = true;
      slotSpinButton.disabled = true;
      slotResult.textContent = '';
      
      // ê° ë¦´ ì• ë‹ˆë©”ì´ì…˜ ì‹œì‘
      const finalSymbols = [];
      
      slotReels.forEach((reel, index) => {
        // 0~5 ì‚¬ì´ì˜ ëœë¤ ì¸ë±ìŠ¤ ìƒì„±
        const randomIndex = Math.floor(Math.random() * symbols.length);
        const symbol = symbols[randomIndex];
        finalSymbols.push(symbol);
        
        // ë¦´ ì• ë‹ˆë©”ì´ì…˜
        const positions = [];
        for (let i = 0; i < 20 + index * 5; i++) {
          const randomSymbol = symbols[Math.floor(Math.random() * symbols.length)];
          positions.push(randomSymbol);
        }
        positions.push(symbol); // ìµœì¢… ì‹¬ë³¼
        
        let currentPosition = 0;
        
        // íšŒì „ ì• ë‹ˆë©”ì´ì…˜
        const spinInterval = setInterval(() => {
          if (currentPosition >= positions.length) {
            clearInterval(spinInterval);
            return;
          }
          
          reel.textContent = positions[currentPosition];
          currentPosition++;
        }, 100);
        
        // íšŒì „ ì¢…ë£Œ íƒ€ì´ë° ì„¤ì • (ë¦´ë§ˆë‹¤ ë‹¤ë¥´ê²Œ)
        setTimeout(() => {
          clearInterval(spinInterval);
          reel.textContent = symbol;
          
          // ë§ˆì§€ë§‰ ë¦´ì´ ë©ˆì·„ì„ ë•Œ ê²°ê³¼ ê³„ì‚°
          if (index === slotReels.length - 1) {
            setTimeout(() => checkSlotResult(finalSymbols, betAmount), 500);
          }
        }, 1000 + (index * 500));
      });
    }
    
    // ìŠ¬ë¡¯ë¨¸ì‹  ê²°ê³¼ í™•ì¸
    function checkSlotResult(symbols, betAmount) {
      isSlotSpinning = false;
      slotSpinButton.disabled = false;
      
      let result = '';
      let winAmount = 0;
      let message = '';
      
      // ëª¨ë“  ì‹¬ë³¼ì´ ê°™ì€ ê²½ìš°
      if (symbols[0] === symbols[1] && symbols[1] === symbols[2]) {
        // ì‹¬ë³¼ì— ë”°ë¥¸ ë°°ë‹¹ ê³„ì‚°
        switch (symbols[0]) {
          case 'ğŸ’':
            winAmount = betAmount * 7;
            message = `3ê°œì˜ ğŸ’! ${betAmount}{{ system_config.get('currency_symbol', 'CM') }} ë² íŒ…ìœ¼ë¡œ ${winAmount}{{ system_config.get('currency_symbol', 'CM') }} íšë“! (7ë°°)`;
            break;
          case 'ğŸ‹':
            winAmount = betAmount * 5;
            message = `3ê°œì˜ ğŸ‹! ${betAmount}{{ system_config.get('currency_symbol', 'CM') }} ë² íŒ…ìœ¼ë¡œ ${winAmount}{{ system_config.get('currency_symbol', 'CM') }} íšë“! (5ë°°)`;
            break;
          case 'ğŸ‡':
            winAmount = betAmount * 3;
            message = `3ê°œì˜ ğŸ‡! ${betAmount}{{ system_config.get('currency_symbol', 'CM') }} ë² íŒ…ìœ¼ë¡œ ${winAmount}{{ system_config.get('currency_symbol', 'CM') }} íšë“! (3ë°°)`;
            break;
          case 'ğŸ’°':
            winAmount = betAmount * 10;
            message = `3ê°œì˜ ğŸ’°! ëŒ€ë°•! ${betAmount}{{ system_config.get('currency_symbol', 'CM') }} ë² íŒ…ìœ¼ë¡œ ${winAmount}{{ system_config.get('currency_symbol', 'CM') }} íšë“! (10ë°°)`;
            break;
          default:
            winAmount = betAmount * 2;
            message = `3ê°œì˜ ${symbols[0]}! ${betAmount}{{ system_config.get('currency_symbol', 'CM') }} ë² íŒ…ìœ¼ë¡œ ${winAmount}{{ system_config.get('currency_symbol', 'CM') }} íšë“! (2ë°°)`;
        }
        
        result = 'win';
        slotResult.textContent = message;
        slotResult.className = 'result-message win';
      }
      // ë‘ ê°œì˜ ê°™ì€ ì‹¬ë³¼
      else if (
        symbols[0] === symbols[1] ||
        symbols[1] === symbols[2] ||
        symbols[0] === symbols[2]
      ) {
        winAmount = betAmount * 2;
        message = `2ê°œì˜ ê°™ì€ ì‹¬ë³¼! ${betAmount}{{ system_config.get('currency_symbol', 'CM') }} ë² íŒ…ìœ¼ë¡œ ${winAmount}{{ system_config.get('currency_symbol', 'CM') }} íšë“! (2ë°°)`;
        result = 'small_win';
        slotResult.textContent = message;
        slotResult.className = 'result-message win';
      }
      // ëª¨ë‘ ë‹¤ë¥¸ ê²½ìš°
      else {
        message = `ì•„ì‰½ê²Œë„ ì‹¤íŒ¨! ${betAmount}{{ system_config.get('currency_symbol', 'CM') }}ì„ ìƒì—ˆìŠµë‹ˆë‹¤.`;
        result = 'lose';
        slotResult.textContent = message;
        slotResult.className = 'result-message lose';
      }
      
      // ì„œë²„ì— ê²Œì„ ê²°ê³¼ ì „ì†¡
      fetch('{{ url_for("games.place_bet") }}', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/x-www-form-urlencoded',
        },
        body: `game_id=casino&bet_amount=${betAmount}&game_data=slot`
      })
      .then(response => response.json())
      .then(data => {
        if (data.success) {
          // ì”ì•¡ ì—…ë°ì´íŠ¸
          userBalance.textContent = `${data.new_balance}{{ system_config.get('currency_symbol', 'CM') }}`;
        } else {
          alert(data.message);
        }
      })
      .catch(error => {
        console.error('Error:', error);
        alert('ê²Œì„ ê²°ê³¼ë¥¼ ì²˜ë¦¬í•˜ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
      });
    }
  });
</script>
{% endblock %}
